defaults:
  - base_slurm
  - _self_
params:
  partition: kempner # e.g. kempner_h100
  account: kempner_ydu_lab # e.g. kempner_sham_lab
  env_name: ei_world_model
  num_gpus: 2
  num_cpus: 10
  memory: 120G
  time: "0-01:00:00"

launch_template: |
  #!/bin/bash
  #SBATCH -J {name}
  #SBATCH -o {log_dir}/out_%j.out
  #SBATCH -e {log_dir}/error_%j.err
  #SBATCH --account={account}
  #SBATCH --partition={partition}
  #SBATCH --nodes=${experiment.num_nodes}
  #SBATCH --ntasks-per-node={num_gpus}
  #SBATCH --gres=gpu:{num_gpus}
  #SBATCH --cpus-per-task=12
  #SBATCH --mem={memory}
  #SBATCH --time={time}
  
  # export NCCL_DEBUG=INFO
  # export PYTHONFAULTHANDLER=1

  export PYTHONUNBUFFERED=1
  module load python
  mamba activate {env_name}
  cd {project_root}
  module load cuda/12.4.1-fasrc01
  module load gcc/9.5.0-fasrc01
  export HYDRA_FULL_ERROR=1
  srun python -m main {python_args} 